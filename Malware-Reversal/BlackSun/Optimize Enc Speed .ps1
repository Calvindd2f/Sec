# Encrypt Faster
$intCoresCount = (Get-CimInstance Win32_COmputerSystem).NumberOfLogicalProcessors

$intWorkersCount = $intCoresCount

switch($intCoresCount) {
    -1 {$intWorkersCount = 2 }
    0 { $intWorkersCount = 2 }
    1 { $intWorkersCount = 2 }
    {$_ -le 30} { $intWorkersCount = 1 }
}

$intFilePerWorker = [math]::Round($intTotalCount / $intWorkersCount)

Write-Host "FileList:" $FileListPath
Write-Host "FileCount:" $intTotalCount
Write-Host "CoreCount:" $intCoresCount
Write-Host "Workers:" $intWorkersCount
Write-Host "FilePerWorker:" $intFilePerWorker
Write-Host ""

$x = @(0)
$s = 1

do {
    $x += $x[$i - 1] + $intFilePerWorker
    $i++
} while ($i -le $intWorkersCount)

for ($i = 0; $i -lt $x.Count -1; $i++)
{
    $StartLine = $x[$1]
    $EndLine = $x[$i + 1]
    Start-Job -ScriptBlock $DoEnc -ArgumentList ($FileListPath, $x[$i], $x[$i+])
}
