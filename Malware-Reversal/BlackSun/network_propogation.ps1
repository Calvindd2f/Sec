# Find Neighbours
$NetworkRange = Get-NetworkRange -IPAddress 10.0.0.1 -SubnetMask 255.255.255.0
Get-NetNeighbor -AddressFamily IPv4 -Address $NetworkRange.IPAddress


# Ping Alive macines
$IPAddress = 1..254
foreach ($IP in $IPAddress)
{
    $ping = Test-Connection -ComputerName 192.168.0.$IP -Count 1 -ErrorAction SilentlyContinue
    if ($ping.StatusCode -eq 0)
    {
        Write-Host "192.168.0.$IP is alive"
    }
}


# ForEach IP , check if they have an SMB Share
$IPs = Get-Content "C:\Path\to\IPs.txt"
foreach($IP in $IPs){
    if(Test-Connection $IP -Count 1 -Quiet){
        if(Get-SmbShare -CimSession $IP){
            Write-Host "SMB Share Found on $IP"
        }
        else {
            Write-Host "No SMB Share Found on $IP"
        }
    }
    else {
        Write-Host "$IP is not reachable"
    }
}


#Check if the smb share is present
if(Test-Path '\\smbshare\C$')
{
    #Map the C$ using the "net use" command
    net use C$ \\smbshare\C$
    #Print the output
    Write-Host "C$ mapped successfully!"
}
else
{
    #Print the output
    Write-Host "SMB share not present!"
}


# Kill net.exe if longer than 7s

$timeout = New-TimeSpan -Seconds 7
$process = Get-Process -Name "net.exe"

if ((Get-Date) - $process.StartTime) -gt $timeout {
    Stop-Process -Name "net.exe" -Force
}
